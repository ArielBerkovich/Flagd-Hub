openapi: 3.0.0
info:
  title: "Flagd Hub API"
  description: "API for managing feature flags."
  version: "1.0.0"
servers:
  - url: "http://localhost:8080/flagd-hub"
tags:
  - name: flagd-hub
    description: API for get/modify feature flags
  - name: flagd-configuration
    description: Exposes the flags.json file for flagd server
paths:
  /flagd/flags:
    get:
      summary: "Get all flags in flagd format"
      description: "Get the configuration for the flagd server in the correct format"
      operationId: getFlagdConfiguration
      tags:
        - flagd-configuration
      responses:
        200:
          description: "flagd configuration"
          content:
            application/json:
              schema:
                type: "object"
  /flagd-hub/login:
    post:
      summary: "Authenticate user"
      description: "Authenticate a user with a username and password."
      operationId: login
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: "The username for authentication"
                password:
                  type: string
                  format: password
                  description: "The password for authentication"
      responses:
        200:
          description: "Authentication successful."
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: "JWT token for authenticated requests."
        401:
          description: "Invalid username or password."
        400:
          description: "Bad request. Missing or invalid parameters."
  /flagd-hub/flags:
    get:
      summary: "Get all feature flags"
      description: "Retrieve a list of all feature flags."
      operationId: getFlags
      tags:
        - flags-hub
      responses:
        200:
          description: "A list of feature flags."
          content:
            application/json:
              schema:
                type: "array"
                items:
                  $ref: "#/components/schemas/FeatureFlag"
    post:
      summary: "Create or update a feature flag"
      description: "Create a new feature flag or override an existing one."
      operationId: createFlag
      tags:
        - flags-hub
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FeatureFlag"
      responses:
        200:
          description: "Flag created or updated successfully."
        400:
          description: "Invalid input."
  /flagd-hub/flags/{flagKey}:
    get:
      summary: "Get a specific feature flag"
      description: "Retrieve details of a specific feature flag by its key."
      operationId: getFlag
      tags:
        - flags-hub
      parameters:
        - name: "flagKey"
          in: "path"
          required: true
          schema:
            type: "string"
      responses:
        200:
          description: "Details of the feature flag."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FeatureFlag"
        404:
          description: "Flag not found."
    delete:
      summary: "Delete a feature flag"
      description: "Remove a feature flag by its key."
      operationId: deleteFlag
      tags:
        - flags-hub
      parameters:
        - name: "flagKey"
          in: "path"
          required: true
          schema:
            type: "string"
      responses:
        204:
          description: "Flag deleted successfully."
        404:
          description: "Flag not found."
    put:
      summary: "Update a feature flag value"
      description: "Update the default variant of an existing feature flag by its key."
      operationId: updateFlagValue
      tags:
        - flags-hub
      parameters:
        - name: "flagKey"
          in: "path"
          required: true
          schema:
            type: "string"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangeDefaultVariantRequest"
      responses:
        200:
          description: "Flag value updated successfully."
        400:
          description: "Invalid input."
        404:
          description: "Flag not found."
  /flagd-hub/flags/{flagKey}/targeting:
    get:
      summary: "Get targeting rules of a feature flag"
      description: "Retrieve targeting rules of the specified feature flag."
      operationId: getFlagTargeting
      tags:
        - flags-hub
      parameters:
        - name: "flagKey"
          in: "path"
          required: true
          schema:
            type: "string"
            description: "The key of the feature flag."
      responses:
        200:
          description: "The targeting rules."
          content:
            application/json:
              schema:
                type: object
        404:
          description: "Flag not found."
    post:
      summary: "Add a targeting rule to a feature flag"
      description: "Add a new targeting rule to an existing feature flag."
      operationId: addFlagTargeting
      tags:
        - flags-hub
      parameters:
        - name: "flagKey"
          in: "path"
          required: true
          schema:
            type: "string"
            description: "The key of the feature flag."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        200:
          description: "Targeting rule added successfully."
        404:
          description: "Flag not found."
    delete:
      summary: "Delete targeting of a feature flag"
      description: "Delete targeting rule of an existing featire"
      operationId: deleteFlagTargeting
      tags:
        - flags-hub
      parameters:
        - name: "flagKey"
          in: "path"
          required: true
          schema:
            type: "string"
            description: "The key of the feature flag."
      responses:
        202:
          description: "Targeting rule deleted."
        404:
          description: "Flag not found."
components:
  schemas:
    ChangeDefaultVariantRequest:
      type: object
      properties:
        defaultVariant:
          type: string
          description: "The new default variant of the flag."
    FeatureFlag:
      type: "object"
      required:
        - "key"
        - "name"
        - "area"
        - "description"
        - "type"
        - "variants"
        - "defaultVariant"
        - "creationTime"
      properties:
        key:
          type: "string"
          description: "The unique identifier for the flag."
        name:
          type: "string"
          description: "The name of the flag"
        area:
          type: "string"
          description: "The name of the area this flag belongs to"
        description:
          type: "string"
          description: "flag description"
        type:
          type: "string"
          enum: ["boolean", "string", "integer", "float", "object"]
          description: "The type of the flag."
        variants:
          type: object
          additionalProperties:
            type: string
        defaultVariant:
          type: "string"
          description: "The chosen variant of the flag."
        targeting:
          type: object
          description: "targeting rules"
        creationTime:
          type: "integer"
          format: "int64"
